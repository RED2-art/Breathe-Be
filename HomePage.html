<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hope | Breathe & Be</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: linear-gradient(to right, #ffe680, #cce5ff); color: #003366; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; visibility: hidden; }
    
    nav { 
      width: 100%; 
      max-width: 1100px; 
      display: flex; 
      flex-wrap: wrap; 
      justify-content: space-between; 
      align-items: center; 
      gap: 10px; 
      margin-bottom: 30px; 
      padding: 12px 25px; 
      border-radius: 16px;
      position: sticky; 
      top: 15px; 
      z-index: 100; 
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    }

    nav a { text-decoration: none; font-weight: 600; color: #004085; background: rgba(227, 242, 253, 0.8); padding: 8px 14px; border-radius: 8px; transition: all 0.3s ease; white-space: nowrap; display: inline-flex; align-items: center; justify-content: center; }
    nav a:hover { background-color: #bbdefb; color: #00264d; transform: translateY(-2px); }
    .profile-menu { position: relative; }
    #profile-menu-button { background-color: #004085; color: white; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0; transition: background-color 0.3s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
    #profile-menu-button:hover { background-color: #0059b3; }
    #profile-menu-dropdown { display: none; position: absolute; right: 0; top: calc(100% + 10px); background: white; border-radius: 8px; box-shadow: 0 5px 25px rgba(0,0,0,0.15); min-width: 220px; z-index: 101; overflow: hidden; }
    #profile-menu-dropdown.show { display: block; }
    .profile-header { padding: 15px; background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; }
    .profile-header p { margin: 0; font-weight: 600; color: #343a40; font-size: 0.9rem; word-break: break-all; }
    .dropdown-item { display: flex; align-items: center; gap: 10px; padding: 12px 15px; color: #343a40; text-decoration: none; font-weight: 500; transition: background-color 0.2s; font-size: 0.95rem; }
    .dropdown-item:hover { background-color: #f1f3f5; }
    .dropdown-divider { height: 1px; background-color: #e9ecef; margin: 5px 0; }
    h1, h2, h3 { font-family: 'Poppins', sans-serif; }
    header h1 { font-size: 3rem; font-weight: 700; margin: 20px 0 10px 0; max-width: 900px; color: #003366; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    
    section { 
      width: 100%; 
      max-width: 900px; 
      border-radius: 16px; 
      padding: 30px; 
      margin-bottom: 30px; 
      text-align: center; 
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      box-shadow: 0 8px 32px 0 rgba(0, 51, 102, 0.1);
    }

    .quote { font-size: 1.5rem; font-style: italic; color: #4a4a4a; margin: 20px 0; }
    .author { font-size: 1rem; color: #7a7a7a; margin-bottom: 10px; }
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; margin-top: 15px; padding: 12px 24px; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-family: 'Poppins', sans-serif; transition: all 0.3s ease; }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); }
    .btn-secondary { background: #e9ecef; color: #003366; }
    .btn-secondary:hover { background: #dee2e6; }
    .btn-primary { background: linear-gradient(135deg, #64b5f6, #42a5f5); color: white; width: 100%; font-size: 1.1rem; }
    .btn-primary:hover { background: linear-gradient(135deg, #90caf9, #64b5f6); }
    .check-in { text-align: left; font-size: 1.1rem; color: #003366; }
    .check-in h2 { font-size: 2.2rem; font-weight: 600; margin-bottom: 15px; text-align: center; }
    .mood-scale { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; font-size: 2.5rem; user-select: none; }
    .mood-scale label { cursor: pointer; transition: all 0.3s ease; }
    .mood-scale input[type="radio"] { display: none; }
    .mood-scale input[type="radio"]:checked + label { transform: scale(1.3) translateY(-5px); filter: drop-shadow(0 4px 10px rgba(144, 202, 249, 0.7)); }
    textarea { width: 100%; min-height: 70px; resize: vertical; padding: 12px; font-size: 1rem; border-radius: 10px; border: 1px solid #ced4da; margin-bottom: 20px; font-family: inherit; background-color: rgba(255, 255, 255, 0.8); }
    #reframeThoughts { width: 100%; min-height: 80px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 1rem; background-color: rgba(255, 255, 255, 0.8); }
    textarea:focus, #reframeThoughts:focus { border-color: #42a5f5; outline: none; box-shadow: 0 0 8px rgba(144, 202, 249, 0.5); background-color: white; }
    #nextSteps { display: none; text-align: left; }
    #nextSteps h2 { font-size: 2.2rem; font-weight: 600; margin-bottom: 15px; text-align: center; }
    #nextSteps h3 { margin-bottom: 15px; margin-top: 25px; color: #004085; display: flex; align-items: center; gap: 10px; }
    #nextSteps ul { list-style-type: none; padding-left: 0; margin-left: 0; margin-bottom: 20px; }
    #nextSteps ul a { color: #004085; text-decoration: none; font-weight: 500; }
    #nextSteps ul a:hover { text-decoration: underline; }
    footer { margin-top: auto; padding: 15px; font-size: 0.9rem; color: #666; text-align: center; width: 100%; max-width: 900px; }
    @media (max-width: 600px) { nav { top: 0; border-radius: 0; } header h1 { font-size: 2.2rem; } .check-in h2, #nextSteps h2 { font-size: 1.8rem; } .mood-scale { font-size: 2rem; } }
  </style>
</head>
<body>

  <nav>
    <a href="VentMachine.html">Vent Machine</a>
    <a href="procrastination.html">Procrastination</a>
    <a href="ted-talks.html">TED Talks</a>
    <a href="leaderboard.html">üèÜ Leaderboard</a>
    <a href="reach-out.html">Reach Out</a>
    <a href="positive-mindset.html">Positive Mindset</a>
    <a href="stress-relief.html">Stress Relief</a>
    <div class="profile-menu">
      <button id="profile-menu-button" aria-label="Open user menu">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.57 10 8 10c-2.57 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/></svg>
      </button>
      <div id="profile-menu-dropdown">
        <div class="profile-header">
          <p id="user-email-display">Loading...</p>
        </div>
        <a href="settings.html" class="dropdown-item">Settings</a>
        <div class="dropdown-divider"></div>
        <a href="#" class="dropdown-item" id="sign-out-button">Sign Out</a>
      </div>
    </div>
  </nav>

  <header><h1>Hope & Healing</h1></header>

  <section>
    <div class="quote" id="quoteText">‚ÄúIn the middle of every difficulty lies opportunity.‚Äù</div>
    <div class="author" id="quoteAuthor">‚Äî Albert Einstein</div>
    <button class="btn btn-secondary" onclick="getRandomQuote()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/></svg>
        New Quote
    </button>
  </section>

  <section class="check-in" id="checkInSection">
    <h2>How are you feeling today?</h2>
    <form id="dailyCheckIn" onsubmit="handleCheckInSubmit(event)">
      <div class="mood-scale" aria-label="Mood scale"><input type="radio" id="mood1" name="mood" value="5" /><label for="mood1">üòÑ</label><input type="radio" id="mood2" name="mood" value="4" /><label for="mood2">üôÇ</label><input type="radio" id="mood3" name="mood" value="3" /><label for="mood3">üòê</label><input type="radio" id="mood4" name="mood" value="2" /><label for="mood4">üòî</label><input type="radio"id="mood5" name="mood" value="1" /><label for="mood5">üò¢</label></div>
      <label for="wentWell">What went well today?</label><textarea id="wentWell" name="wentWell" placeholder="Share something positive..." required></textarea>
      <label for="toImprove">What can be improved?</label><textarea id="toImprove" name="toImprove" placeholder="What could you work on?" required></textarea>
      <button type="submit" class="btn btn-primary">Next</button>
    </form>
  </section>

  <section id="nextSteps" style="display: none;">
    <h2>What would you like to do now?</h2>
    <h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm4 8c0 1-1 1-1 1H5s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.57 10 8 10c-2.57 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/></svg>Contact a support person:</h3>
    <ul>
      <li><strong>Year Advisors:</strong>
        <ul style="margin-top: 8px; list-style-type: disc; padding-left: 20px;"> 
          <li><a href="mailto:rebecca.lee91@det.nsw.edu.au">Year 12: Rebecca Lee</a></li>
          <li><a href="mailto:Josiah.lau1@det.nsw.edu.au">Year 11: Josiah Lau</a></li>
          <li><a href="mailto:Emma.manahan2@det.nsw.edu.au">Year 10: Emma Manahan</a></li>
          <li><a href="mailto:Isabella.Falciola1@det.nsw.edu.au">Year 9: Isabella Falciola</a></li>
          <li><a href="mailto:Georgia.papas3@det.nsw.edu.au">Year 8: Georgia Papas</a></li>
          <li><a href="mailto:Morgan.crammond@det.nsw.edu.au">Year 7: Morgan Crammond</a></li>
        </ul>
      </li>
      <li><a href="mailto:melinda.wong@det.nsw.edu.au">Deputy Principal: Melinda Wong</a></li>
    </ul>
    <h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg>Self-help strategies:</h3>
    <ul style="list-style-type: disc; padding-left: 20px;">
        <li>Go for a short walk</li>
        <li>Write in a journal</li>
        <li>Practice mindfulness for 5 minutes</li>
        <li>Listen to calming music</li>
    </ul>
    <h3>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13h-5a.5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm6 8.5a.5.5 0 0 1 .5-.5h.5a.5.5 0 0 1 0 1h-.5a.5.5 0 0 1-.5-.5z"/><path d="M4.376 11.544c.045-.09.09-.18.14-.264.07-.117.155-.23.25-.338a2.98 2.98 0 0 1 2.228-1.18.99.99 0 0 1 .445.105c.152.076.299.19.435.328a3.1 3.1 0 0 1 1.05 2.148.5.5 0 0 1-.447.495l-.832.22a.5.5 0 0 1-.61-.492 1.99 1.99 0 0 0-.84-1.298.99.99 0 0 0-.936-.105c-.328.094-.61.28-.813.528a2 2 0 0 0-.453.832l-.142.485a.5.5 0 0 1-.95.094l-.17-.516z"/></svg>
        Reframe Your Thoughts
    </h3>
    <p>List ways you can see this situation differently, find a positive angle, and strategies to overcome any negative thinking:</p>
    <textarea id="reframeThoughts" placeholder="E.g. Instead of 'I failed,' I can think 'I learned what doesn't work,' and next time I'll try‚Ä¶"></textarea>
    <div id="breathingTimer" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.4);">
        <h3>Breathing Exercise</h3>
        <p style="font-size: 2.5rem; margin: 10px 0; font-family: 'Poppins', sans-serif;" id="timerDisplay">01:00</p>
        <button class="btn btn-secondary" onclick="startBreathing()">Start 1-min Timer</button>
        <button class="btn btn-secondary" onclick="resetBreathing()">Reset</button>
    </div>

    <div id="points-message" style="display: none; margin-top: 40px; text-align: center; padding: 20px; background-color: #e3f2fd; border-radius: 12px; border: 1px solid #90caf9;">
      <h3 style="margin: 0; color: #004085;">üéâ Congratulations! You earned 10 points for checking in today! üéâ</h3>
    </div>
  </section>

  <section class="feedback-section">
    <h2>We value your feedback</h2>
    <form id="feedbackForm" onsubmit="handleFeedbackSubmit(event)">
      <label for="feedbackText">Your feedback or suggestions:</label>
      <textarea id="feedbackText" name="feedbackText" placeholder="Share your thoughts here..." required></textarea>
      <button type="submit" class="btn btn-primary">Submit Feedback</button>
    </form>
  </section>
  
  <!-- THIS IS THE UPDATED LINK -->
  <footer><a href="aboutus.html">About Us</a>¬†|¬†¬© 2025 Breathe & Be. All rights reserved.</footer>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut as firebaseSignOut } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, increment, setDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCaimG4cdtkGHWqYHn9fa5vpbfNGuffgSs",
      authDomain: "mental-health-app-5754d.firebaseapp.com",
      projectId: "mental-health-app-5754d",
      storageBucket: "mental-health-app-5754d.appspot.com",
      messagingSenderId: "772808891462",
      appId: "1:772808891462:web:07675a2895d0dd59f93e47"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let currentUser = null; 

    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user; 
        document.body.style.visibility = 'visible';
        const userEmailDisplay = document.getElementById('user-email-display');
        if (userEmailDisplay) { userEmailDisplay.textContent = user.email; }
        initPageFunctions();
      } else {
        window.location.href = 'login.html';
      }
    });

    window.handleCheckInSubmit = async function(e) {
      e.preventDefault();
      if (!currentUser) {
        console.error("No user logged in.");
        return; 
      }

      const userDocRef = doc(db, "users", currentUser.uid);
      const today = new Date().toISOString().split('T')[0];

      try {
        const docSnap = await getDoc(userDocRef);

        if (docSnap.exists()) {
          const lastCheckIn = docSnap.data().lastCheckIn;
          
          if (lastCheckIn !== today) {
            await updateDoc(userDocRef, {
                points: increment(10),
                lastCheckIn: today
            });
            console.log("SUCCESS: 10 points awarded for today!");
            document.getElementById('points-message').style.display = 'block';
          } else {
            console.log("INFO: Already checked in today. No points awarded.");
          }
        } else {
          console.log("User document not found in Firestore. Creating it now with points.");
          await setDoc(userDocRef, {
              email: currentUser.email,
              username: currentUser.displayName || currentUser.email.split('@')[0],
              points: 10,
              lastCheckIn: today
          });
          console.log("SUCCESS: New user document created, 10 points awarded!");
          document.getElementById('points-message').style.display = 'block';
        }

      } catch (error) {
          console.error("Error during check-in process: ", error);
      }
      
      document.getElementById('checkInSection').style.display = 'none';
      document.getElementById('nextSteps').style.display = 'block';
    };
    
    const signOutButton = document.querySelector('#sign-out-button');
    if(signOutButton) {
        signOutButton.addEventListener('click', (e) => {
            e.preventDefault();
            firebaseSignOut(auth).catch((error) => console.error("Sign out error", error));
        });
    }

    window.signOut = function() {};
    
    const profileButton = document.getElementById('profile-menu-button');
    const profileDropdown = document.getElementById('profile-menu-dropdown');
    if (profileButton && profileDropdown) {
        profileButton.addEventListener('click', (event) => {
            event.stopPropagation();
            profileDropdown.classList.toggle('show');
        });
    }
    window.addEventListener('click', (event) => {
        if (profileDropdown && profileDropdown.classList.contains('show')) {
            if (!profileButton.contains(event.target) && !profileDropdown.contains(event.target)) {
                profileDropdown.classList.remove('show');
            }
        }
    });
    const quotes = [ { text: "In the middle of every difficulty lies opportunity.", author: "Albert Einstein" }, { text: "Hope is being able to see that there is light despite all of the darkness.", author: "Desmond Tutu" } ];
    window.getRandomQuote = function() {
        const i = Math.floor(Math.random() * quotes.length);
        document.getElementById('quoteText').textContent = `‚Äú${quotes[i].text}‚Äù`;
        document.getElementById('quoteAuthor').textContent = `‚Äî ${quotes[i].author}`;
    }
    let breathingInterval, remaining = 60;
    function updateTimerDisplay() {
        const m = String(Math.floor(remaining / 60)).padStart(2,'0');
        const s = String(remaining % 60).padStart(2,'0');
        document.getElementById('timerDisplay').textContent = `${m}:${s}`;
    }
    window.startBreathing = function() {
        if (remaining < 60 && remaining > 0) return; 
        clearInterval(breathingInterval);
        remaining = 60;
        updateTimerDisplay();
        breathingInterval = setInterval(() => {
            remaining--;
            updateTimerDisplay();
            if (remaining <= 0) {
                clearInterval(breathingInterval);
                document.getElementById('timerDisplay').textContent = "Done!";
            }
        }, 1000);
    }
    window.resetBreathing = function() {
        clearInterval(breathingInterval);
        remaining = 60;
        updateTimerDisplay();
    }
    window.handleFeedbackSubmit = function(e) {
      e.preventDefault();
      alert('Thank you for your feedback!');
      e.target.reset();
    };
    function initPageFunctions() {
        updateTimerDisplay();
        getRandomQuote(); 
    }
  </script>
</body>
</html>